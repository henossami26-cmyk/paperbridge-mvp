<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PaperBridge â€” MVP</title>
  <style>
    body{font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;background:#f7f7fb}
    .wrap{max-width:1100px;margin:0 auto}
    h1{margin:0 0 12px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:#fff;border:1px solid #e6e6ef;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.04)}
    .in{padding:16px}
    textarea{width:100%;height:230px;border:1px solid #d7d7e6;border-radius:10px;padding:12px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    button{border:1px solid #d7d7e6;border-radius:10px;background:#0f62fe;color:#fff;padding:8px 12px;cursor:pointer}
    button.secondary{background:#fff;color:#0f172a}
    .out{background:#fff;border:1px solid #e6e6ef;border-radius:12px;padding:16px;min-height:120px}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#1f2937;font-size:12px;border:1px solid #c7d2fe;margin-right:6px}
    .list li{padding:8px 0;border-top:1px solid #f0f0f6}
    small{color:#6b7280}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ðŸŒ‰ PaperBridge â€” Understand Every Form</h1>
  <p><small>Client-only demo. No data leaves your browser.</small></p>

  <div class="grid">
    <div class="card">
      <div class="in">
        <label><strong>Paste form text</strong></label>
        <textarea id="input">By signing this form, the applicant hereby consents to disclose their SIN pursuant to the program assessment. Notwithstanding any other provision herein, failure to remit sufficient documentation may render the application void.</textarea>
        <div class="row">
          <button id="btnSimple">Simplify</button>
          <button id="btnLine" class="secondary">Line-by-line</button>
          <button id="btnCopy" class="secondary">Copy simplified</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="in">
        <div class="row">
          <span class="pill" id="modePill">Mode: Simple</span>
          <span class="pill" id="termPill">Terms: 0</span>
        </div>
        <div id="output" class="out"></div>
      </div>
    </div>
  </div>

  <div class="grid" style="margin-top:16px">
    <div class="card">
      <div class="in">
        <div><strong>Glossary</strong></div>
        <ul id="gloss" class="list"></ul>
      </div>
    </div>
    <div class="card">
      <div class="in">
        <div><strong>Tips</strong></div>
        <ol>
          <li>Use **Line-by-line** to see each sentence with its simpler version.</li>
          <li>Weâ€™ll add a private **Profile Vault** next (name, DOB, address, passport, SIN).</li>
          <li>Then weâ€™ll **auto-fill PDFs** in-browser using your profile.</li>
        </ol>
      </div>
    </div>
  </div>
</div>
<script>
<script>
// 1) Legal/bureaucratic jargon (shows up in Glossary)
const JARGON_MAP = {
  hereby:{simple:"by this",note:"Formal for â€˜by this document/actionâ€™."},
  thereon:{simple:"on that",note:"Refers to something mentioned earlier."},
  thereof:{simple:"of that",note:"Refers back to earlier thing."},
  therein:{simple:"in that",note:"In that document/place."},
  herein:{simple:"in this",note:"In this document."},
  notwithstanding:{simple:"despite",note:"Prefer â€˜despiteâ€™."},
  pursuant:{simple:"according to",note:"In line with / according to."},
  commence:{simple:"start",note:"Plain verb."},
  terminate:{simple:"end",note:"Plain verb."},
  remit:{simple:"send",note:"Often a payment/documents."},
  sufficient:{simple:"enough",note:"Plain word."},
  utilize:{simple:"use",note:"Prefer â€˜useâ€™."},
  applicant:{simple:"person applying",note:"The person filling the form."},
  disclose:{simple:"share",note:"Share information."},
  verify:{simple:"confirm",note:"Make sure itâ€™s true."},
  void:{simple:"not valid",note:"Wonâ€™t be accepted."},
  assessment:{simple:"review/decision",note:"Governmentâ€™s review."},
  domicile:{simple:"permanent home",note:"Main legal home."},
  affidavit:{simple:"sworn statement",note:"Statement promised as true."},
  spouse:{simple:"husband or wife",note:"Married partner."},
  "common-law":{simple:"live-in partner (12+ months)",note:"Lived together 12+ months."},
  sin:{simple:"Social Insurance Number",note:"9-digit number in Canada."}
};

// 2) General plain-English rewrites (works on everyday text)
const PHRASES = [
  [/in accordance with/gi, "according to"],
  [/in the event that/gi, "if"],
  [/in order to/gi, "to"],
  [/prior to/gi, "before"],
  [/subsequent to/gi, "after"],
  [/with respect to/gi, "about"],
  [/with regard to/gi, "about"],
  [/for the purpose of/gi, "to"],
  [/has shifted to/gi, "now uses"],
  [/is required to/gi, "must"],
  [/is not required to/gi, "does not have to"],
  [/including but not limited to/gi, "including"],
  [/such as/gi, "like"],
  [/specific forms needed depend on/gi, "forms depend on"],
  [/in order for/gi, "for"],
  [/alternative formats upon request/gi, "other formats if you ask"]
];

// Split sentences safely
const splitSentences = (t) => t.trim().replace(/\s+/g,' ').split(/(?<=[.!?])\s+/);

// Apply legalese replacements + collect glossary hits
function replaceJargon(text){
  const hits = {};
  const out = text.replace(/\b[\w-]+\b/gi, (tok) => {
    const key = tok.replace(/[^\w-]/g,"").toLowerCase();
    const entry = JARGON_MAP[key];
    if(!entry) return tok;
    hits[key] ??= { ...entry, count:0 };
    hits[key].count++;
    // Keep capitalization of the original token
    const isCap = /^[A-Z]/.test(tok);
    const simple = entry.simple;
    return isCap ? simple.charAt(0).toUpperCase()+simple.slice(1) : simple;
  });
  return { text: out, hits };
}

// Apply general simplifications
function simplifyPhrases(text){
  let t = text;
  for(const [re, rep] of PHRASES) t = t.replace(re, rep);
  return t;
}

function simplifyAll(text){
  // 1) phrase-level simplifications
  let t = simplifyPhrases(text);
  // 2) legalese substitutions (and collect glossary)
  const { text: withJargon, hits } = replaceJargon(t);
  // 3) split into lines + also provide a single simple paragraph
  const sentences = splitSentences(text);
  const simplifiedSentences = splitSentences(withJargon).map(s => s.trim());
  return {
    sentences,
    simplifiedSentences,
    simplified: simplifiedSentences.join(" "),
    glossary: Object.entries(hits).map(([term,v])=>({term, ...v}))
  };
}

// Wire up UI
const inputEl  = document.getElementById('input');
const outputEl = document.getElementById('output');
const glossEl  = document.getElementById('gloss');
const termPill = document.getElementById('termPill');
const modePill = document.getElementById('modePill');

function render(mode='simple'){
  const r = simplifyAll(inputEl.value);
  modePill.textContent = `Mode: ${mode==='simple'?'Simple':'Line-by-line'}`;
  termPill.textContent = `Terms: ${r.glossary.length}`;

  if(mode==='simple'){
    outputEl.innerHTML = r.simplified;
  } else {
    outputEl.innerHTML = r.sentences.map((orig, i)=>`
      <div style="margin-bottom:12px">
        <div><small>Original</small><br>${orig}</div>
        <div style="margin-top:6px"><small>Simplified</small><br><strong>${r.simplifiedSentences[i]||''}</strong></div>
      </div>`).join('');
  }

  glossEl.innerHTML = r.glossary.length
    ? r.glossary.map(g=>`<li><strong>${g.term}</strong><br>${g.simple}<br><small>${g.note}</small></li>`).join('')
    : '<li><small>No special terms detected.</small></li>';
}

document.getElementById('btnSimple').onclick = () => render('simple');
document.getElementById('btnLine').onclick   = () => render('line');
document.getElementById('btnCopy').onclick   = async () => {
  const r = simplifyAll(inputEl.value);
  try { await navigator.clipboard.writeText(r.simplified); alert('Copied!'); }
  catch { alert('Could not copy.'); }
};

render('simple');
</script>
</body>
</html>
